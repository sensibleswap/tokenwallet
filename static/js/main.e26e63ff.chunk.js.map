{"version":3,"sources":["web3/wallet.ts","lib/util.ts","lib/index.ts","state/state.ts","state/action.ts","hooks.js","App.js","reportWebVitals.js","index.js"],"names":["NetWork","div","a","biga","BigNumber","i","toString","multi","multipliedBy","plus","minus","getDecimalString","decimalNum","pow","lessThan","b","lt","lessThanEqual","lte","greaterThan","gt","greaterThanEqual","gte","checkFeeRate","tx","minFeeRate","size","toBuffer","length","feeRate","getFee","msg","message","error","Error","safeJsonStringify","data","JSON","parse","stringify","key","value","getSensibleApiPrefix","network","test","Mainnet","isSensibleSuccess","res","code","sleep","ms","Promise","resolve","setTimeout","formatValue","decimal","util","isValidAddress","address","bsv","Address","_","generateKeysFromEmailPassword","email","pass","Testnet","s","regchars","match","regupchars","regnums","bufferS","Buffer","from","crypto","Hash","sha256","tmp","hex","privateKey","PrivateKey","toAddress","publicKey","toPublicKey","getSensibleFtHistoryUrl","genesis","codehash","getWocAddressUrl","url","getWocTransactionUrl","txid","getAddressSensibleFtList","page","getAddressSensibleFtListByPage","list","console","log","apiPrefix","axios","get","map","item","tokenName","name","tokenSymbol","symbol","tokenDecimal","balance","pendingBalance","getAddressBsvUtxoList","cursor","txId","outputIndex","vout","satoshis","satoshi","getAddressBsvBalanceByUtxo","sum","utxoList","total","reduce","prev","cur","broadcastSensibleQeury","rawtx","apiPrefx","post","txHex","Transaction","hash","mapBsvFeeError","err","transferSensibleFt","signers","senderWif","receivers","SensibleFT","selectSigners","selectRes","ft","purse","feeb","signerSelecteds","transfer","txParseRes","parseTransaction","serialize","outputs","errMsg","isBsvAmountExceed","indexOf","isFtUtxoAmountExceed","mergeBsvUtxo","merge","ownerWif","Signature","sighashType","SIGHASH_ALL","SIGHASH_FORKID","unlockP2PKHInput","inputIndex","sigtype","sig","prevTxId","inputs","signature","Sighash","sign","output","script","satoshisBN","setScript","Script","buildPublicKeyHashIn","toDER","checkBsvReceiversSatisfied","satified","txAddressAmountMap","getKey","amount","forEach","rece","transferBsv","totalOutput","utxoValue","selectedUtxoList","feePerKb","dust","utxoResList","push","addInput","Input","PublicKeyHash","Output","buildPublicKeyHashOut","empty","to","change","clearOutputs","index","type","Sentry","fee","utxolist","hasProtoFlag","scriptBuffer","protoHeader","compare","parseTokenContractScript","scriptBuf","hasSensibleFlag","dataPart","tokenProto","tokenAddress","toHex","getCodeHash","input","ftToken","ret","addr","tokenAmount","isFt","ftDetail","defaultSatotx","satotxApiPrefix","satotxPubKey","initialState","account","bsvBalance","sensibleFtList","satotxConfigMap","Map","set","createGlobalState","useGlobalState","getGlobalState","setGlobalState","accountStorageKey","saveAccountStorage","str","localStorage","setItem","getAccountStorage","getItem","isSupportToken","pollingBsvTimer","pollingSensibleFtTimer","pollingBsvBalance","clearInterval","fn","window","setInterval","pollingSensibleFtBalance","valid_sensibleFtList","filter","saveAccount","password","top","hashdata","decodeURIComponent","location","substr","postMsg","createPostMsg","id","preAccount","preBsvBalance","preSensibleFtBalance","accountKey","emit","isBsvBalanceEqual","b1","b2","isSensibleFtBalanceEqual","sort","item1","item2","localeCompare","isAccountEqual","requestLatestData","latestAccount","latestBalance","equal","handleRequest","method","on","eventData","requestId","params","response","signed","useOnceCall","cb","condition","isCalledRef","useRef","useEffect","current","Option","Select","Header","useState","decodeModalVisible","setDecodeModalVisible","setRawtx","setNetwork","resultModalVisible","setResultModalVisible","className","title","content","onClick","actions","open","visible","onCancel","TextArea","rows","onChange","e","target","style","width","placeholder","LoginPanel","Form","useForm","form","bordered","layout","onFinish","Modal","confirm","href","rel","onOk","getFieldsValue","Item","rules","required","prefix","UserOutlined","min","transform","trim","Password","LockOutlined","visibilityToggle","label","htmlType","AccountInfoPanel","onWithDraw","onTransfer","handleTransfer","margin","justify","span","itemLayout","dataSource","renderItem","placement","Meta","description","height","display","alignItems","getRabinPubKeys","getRabins","rabinApis","promises","rabins","rabinApi","all","then","pubKey","TransferAllPanel","initDatas","onTransferCallback","loading","setLoading","values","isBsv","token","find","setFieldsValue","handleSubmit","receiverLists","broadcastBsv","formatReceiverList","transferRes","broadcastSensibleFt","broadcastAll","totalOutputValueFloatDuck","totalOutputValue","LeftOutlined","formatBalance","canEdit","fontWeight","List","fields","add","remove","fieldKey","restField","marginBottom","align","validator","reject","disabled","shape","icon","MinusOutlined","PlusOutlined","block","TransferPanel","initReceivers","receiverList","success","App","trasfering","setTransfering","trasferSensibleFtGenesis","setTrasferSensibleFtGenesis","setInitReceivers","setInitDatas","initRabins","setRabins","handleCancelTransfer","getHashData","opener","handlePopResponseCallback","resObj","requestAccountCondition","transferBsvCondition","outputTotal","datas","v","obu","onbeforeunload","event","overflow","accountName","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","isIframe","dsn","integrations","Integrations","BrowserTracing","tracesSampleRate","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e26e63ff.chunk.js","sourcesContent":["\nexport enum NetWork {\n  Testnet = 'testnet',\n  Mainnet = 'mainnet',\n  STN = 'STN'\n}\n\n","import BigNumber from \"bignumber.js\";\nimport {message} from 'antd'\n\n// 最大是253，那么全部用 string 吧\ntype NumberDuck = number | string\n\nexport function div (a: NumberDuck, ...others: NumberDuck[]): string {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.div(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function multi(a: NumberDuck,  ...others: NumberDuck[]): string {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.multipliedBy(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function plus(a: NumberDuck,  ...others: NumberDuck[]): string {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.plus(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function minus(a: NumberDuck,  ...others: NumberDuck[]): string {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.minus(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function getDecimalString(decimalNum: number): string {\n    return new BigNumber(10).pow(decimalNum).toString()\n}\n\nexport function lessThan(a: NumberDuck, b: NumberDuck):boolean {\n    let biga = new BigNumber(a)\n    return biga.lt(new BigNumber(b))\n}\n\nexport function lessThanEqual(a: NumberDuck, b: NumberDuck):boolean {\n    let biga = new BigNumber(a)\n    return biga.lte(new BigNumber(b))\n}\n\nexport function greaterThan(a: NumberDuck, b: NumberDuck):boolean {\n    let biga = new BigNumber(a)\n    return biga.gt(new BigNumber(b))\n}\n\nexport function greaterThanEqual(a: NumberDuck, b: NumberDuck):boolean {\n    let biga = new BigNumber(a)\n    return biga.gte(new BigNumber(b))\n}\n\nexport function equal(a: NumberDuck, b: NumberDuck): boolean {\n    let biga = new BigNumber(a)\n    return biga.eq(new BigNumber(b))\n}\n\nexport function toString(a: NumberDuck): string {\n    return new BigNumber(a).toString()\n}\n\nexport function checkFeeRate(tx: any, minFeeRate?: number) {\n    minFeeRate = minFeeRate || 0.5\n    const size = tx.toBuffer().length\n    const feeRate = tx.getFee() / size;\n    if (feeRate < minFeeRate) {\n        const msg = `The fee rate should not be less than ${minFeeRate}, but in the end it is ${feeRate}`\n        message.error(msg)\n        throw new Error(msg)\n    }\n}\n\nexport function safeJsonStringify(data: any) {\n    return JSON.parse(JSON.stringify(data, (key, value) =>\n        typeof value === 'bigint'\n            ? value.toString()\n            : value // return everything else unchanged\n    ));\n}\n\n// 传过来 string/int -> 显示(float) -> bigint\n","import { bsv, toHex } from 'scryptlib';\nimport { NetWork } from '../web3';\nimport {Key, SensibleFt, SensibleSatotx, TransferReceiver, BsvUtxo} from '../state/stateType'\nimport axios from 'axios'\nimport {SensibleFT} from 'sensible-sdk'\nimport * as tokenProto from 'sensible-sdk/dist/bcp02/tokenProto'\nimport * as protoHeader from 'sensible-sdk/dist/common/protoheader'\nimport { getCodeHash } from 'sensible-sdk/dist/common/utils';\nimport * as util from './util'\nimport * as Sentry from \"@sentry/react\";\n\nfunction getSensibleApiPrefix(network: NetWork) {\n    const test = network === NetWork.Mainnet ? '' : '/test'\n    return `https://api.sensiblequery.com${test}`\n}\nfunction isSensibleSuccess(res: any) {\n    return res.code === 0 && res.msg === 'ok'\n}\n\nfunction sleep(ms: number) {\n    return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function formatValue(value: number, decimal: number) {\n    // const bigNum = bsv.crypto.BN.fromNumber(value)\n    // return bigNum.div(10**decimal).toString(10)\n    // return value / (10**decimal)\n    return util.div(value, util.getDecimalString(decimal))\n}\n\nexport function isValidAddress(network: NetWork, address: string) {\n    try {\n        new bsv.Address(address, network)\n        return true\n    } catch (_) {\n        return false\n    }\n}\n\nexport function generateKeysFromEmailPassword(email: string, pass: string, network: NetWork = NetWork.Testnet): Key {\n    let s: string = email\n    s += '|'+pass+'|';\n    s += s.length+'|!@'+((pass.length*7)+email.length)*7;\n    var regchars = (pass.match(/[a-z]+/g)) ? pass.match(/[a-z]+/g)!.length : 1;\n    var regupchars = (pass.match(/[A-Z]+/g)) ? pass.match(/[A-Z]+/g)!.length : 1;\n    var regnums = (pass.match(/[0-9]+/g)) ? pass.match(/[0-9]+/g)!.length : 1;\n    s += ((regnums+regchars)+regupchars)*pass.length+'3571';\n    s += (s+''+s);\n\n    let bufferS = Buffer.from(s)\n    bufferS = bsv.crypto.Hash.sha256(bufferS)\n\tfor(let i=0;i<=49;i++){\n        const tmp = Buffer.from(bufferS.toString('hex'))\n        bufferS = bsv.crypto.Hash.sha256(tmp)\n\t}\n    const hex = bsv.crypto.Hash.sha256(Buffer.from(bufferS.toString('hex'))).toString('hex')\n    \n    const privateKey = new bsv.PrivateKey(hex, network)\n    const address = privateKey.toAddress(network).toString()\n    \n    return {\n        address,\n        privateKey: privateKey.toString(),\n        publicKey: privateKey.toPublicKey().toString()\n    }\n}\n\nexport function getSensibleFtHistoryUrl(network: NetWork, address: string, genesis: string, codehash: string) {\n    // https://sensiblequery.com/#/ft/utxo/a1961d0c0ab39f1bd0f79c2f6ae27138cca0620c/d4266deb03b5fdb7c9af39fa71f86f4b1f6390422e9bcd1556399a3f0063965f00000000/1111111111111111111114oLvT2\n    const test = network === NetWork.Mainnet ? '' : '/test'\n    return `https://sensiblequery.com${test}/#/ft/utxo/${codehash}/${genesis}/${address}`\n}\n\n\nexport function getWocAddressUrl(network: NetWork, address: string) {\n    let url = ''\n    if (network === NetWork.Mainnet) {\n        url = 'https://whatsonchain.com/address/'\n    } \n    if (network === NetWork.Testnet) {\n        url = 'https://test.whatsonchain.com/address/'\n    }\n    if (!url) {\n        return url\n    }\n    url += address\n    return url\n}\n\nexport function getWocTransactionUrl(network: NetWork, txid: string) {\n    let url = ''\n    if (network === NetWork.Mainnet) {\n        url = 'https://whatsonchain.com/tx/'\n    } \n    if (network === NetWork.Testnet) {\n        url = 'https://test.whatsonchain.com/tx/'\n    }\n    if (!url) {\n        return url\n    }\n    url += txid\n    return url\n}\n\n// todo 分页获取\nexport async function getAddressSensibleFtList(network: NetWork, address: string): Promise<SensibleFt[]> {\n    // todo remove next line\n    let res: SensibleFt[] = []\n    try {\n        for (let page = 1; ; page++) {\n            const list = await getAddressSensibleFtListByPage(network, address, page)\n            res = [...res, ...list]\n            if (list.length === 0) {\n                break\n            }\n        }\n    } catch (err) {\n        console.log('getAddressSensibleFtList error')\n        console.error(err)\n    }\n    return res;\n}\n\nexport async function getAddressSensibleFtListByPage(network: NetWork, address: string, page: number): Promise<SensibleFt[]> {\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/ft/summary/${address}?cursor=${(page - 1) * 20}&size=20`)\n    const success = isSensibleSuccess(data)\n\n    if (success) {\n        return (data.data || []).map((item: any) => {\n            return {\n                genesis: item.genesis,\n                codehash: item.codehash,\n                tokenName: item.name,\n                tokenSymbol: item.symbol,\n                tokenDecimal: item.decimal,\n                balance: util.plus(item.balance, item.pendingBalance),\n            }\n        })\n    }\n    throw new Error(data.msg)\n}\n\n// 获取 bsv utxo\nexport async function getAddressBsvUtxoList(network: NetWork, address: string, page: number): Promise<BsvUtxo[]> {\n    const pageSize = 16\n    const cursor = (page - 1) * pageSize\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/address/${address}/utxo?cursor=${cursor}&size=${pageSize}`)\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return (data.data || []).map((item: any) => {\n            return {\n                txId: item.txid, \n                outputIndex: item.vout,\n                satoshis: item.satoshi,\n                address: address,\n            }\n        })\n    }\n\n    // const fakeUtxoList: BsvUtxo[] = [\n    //     {\n    //         txId: '6a18f5b859fb4c281affaf8f6245a2fe0813867d4b7d24948da18e099462619b',\n    //         outputIndex: 0,\n    //         satoshis: 98775,\n    //         address,\n    //     },\n    //     {\n    //         txId: 'de980facfe7b10a84bfa658130b2b7725565510f967534459d63e6c9717a08e2',\n    //         outputIndex: 0,\n    //         satoshis: 98679,\n    //         address,\n    //     },\n    //     {\n    //         txId: '8ace8ab3995de63af867d929561b3a48bb499ea8d6e64c2ecefba29c6213764f',\n    //         outputIndex: 4,\n    //         satoshis: 4939535,\n    //         address,\n    //     },\n    //     {\n    //         txId: '74bec534becb77f894bcacaf2386604642a1ea00e371838b1780f5235a12bb9d',\n    //         outputIndex: 2,\n    //         satoshis: 45033315,\n    //         address,\n    //     }\n    // ]\n    // if (page === 1) {\n    //     return fakeUtxoList\n    // }\n    // return []\n    \n    throw new Error(data.msg)\n}\n\n// 获取bsv 余额, 这里加入了ft utxo的值，暂时不能用\nexport async function getAddressBsvBalance(network: NetWork, address: string): Promise<number | string> {\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/address/${address}/balance`)\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return util.plus(data.data.satoshi, data.data.pendingSatoshi)\n    }\n    throw new Error(data.msg)\n}\n\nexport async function getAddressBsvBalanceByUtxo(network: NetWork, address: string): Promise<string> {\n    let page = 1\n    let sum: string = '0'\n    for (;;) {\n        const utxoList = await getAddressBsvUtxoList(network, address, page)\n        const total = utxoList.reduce((prev: any, cur: any) => util.plus(prev, cur.satoshis), '0')\n        sum = util.plus(sum, total)\n        if (utxoList.length === 0) {\n            break\n        }\n        page++\n    }\n    console.log('balance', sum)\n    return sum\n}\n\n// 获取 sensible ft 余额\nexport async function getAddressSensibleFtBalance(network: NetWork, address: string, codehash: string, genesis: string): Promise<number> {\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/ft/balance/${codehash}/${genesis}/${address}`)\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return data.data.satoshi\n    }\n    throw new Error(data.msg)\n}\n\n// 获取 sensible 余额 地址\nexport async function getSensibleAddressUrl(network: NetWork, address: string, codehash: string, genesis: string) {\n    const test = network === NetWork.Mainnet ? '' : '/test'\n    // https://sensiblequery.com/#/ft/utxo/ac939f3cf7aba022d09f05e5448f1e635c81dbb3/598d220eaecb68cf783cbc6cc6295d042897874f/1FJCX1QG7KyaHpx1U2iVe4xoAWNVB1Wd3L\n    return `https://sensiblequery.com${test}/#/ft/utxo/${codehash}/${genesis}/${address}`\n}\n\n\n// 广播交易\nexport async function broadcastSensibleQeury(network: NetWork, rawtx: string) {\n    const apiPrefx = getSensibleApiPrefix(network)\n    const {data} = await axios.post(`${apiPrefx}/pushtx`, {\n        txHex: rawtx,\n    })\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return new bsv.Transaction(rawtx).hash\n    }\n    throw new Error(data.msg)\n}\n\n\n// 发送 token 交易\nconst mapBsvFeeError = (err: Error) => {\n    if (err.message === \"Insufficient balance.\") {\n        // 将模糊的错误信息转换\n        return new Error('Low bsv balance to pay miners')\n    }\n    return err\n}\nexport async function transferSensibleFt(network: NetWork, signers: SensibleSatotx[], senderWif: string, receivers: TransferReceiver[], codehash: string, genesis: string, ){\n    const selectRes = signers && signers.length > 0 ? await SensibleFT.selectSigners(signers) : await SensibleFT.selectSigners();\n    // const selectRes = await SensibleFT.selectSigners();\n\n    const ft = new SensibleFT({\n        network: network as any,\n        purse: senderWif,\n        feeb: 0.5,\n        signerSelecteds: selectRes.signerSelecteds,\n        signers: selectRes.signers,\n    })\n    console.log('transferSensibleFt', receivers, network, codehash, genesis, signers)\n\n    try {\n        const {txid, tx} = await ft.transfer({\n            senderWif: senderWif,\n            receivers,\n            codehash,\n            genesis,\n        })\n        util.checkFeeRate(tx)\n        const txParseRes = parseTransaction(network, tx.serialize(true))\n        return {\n            txid,\n            outputs: txParseRes.outputs,\n        }\n    } catch (_err) {\n        const err = mapBsvFeeError(_err)\n        const errMsg = err.toString();\n        const isBsvAmountExceed =\n          errMsg.indexOf(\n            \"The count of utxos should not be more than 3 in transfer\"\n          ) > 0;\n        let isFtUtxoAmountExceed = errMsg.indexOf('Too many token-utxos') > 0;\n        console.log(\"broadcast sensible ft error \");\n        console.error(err);\n\n        if (!isBsvAmountExceed && !isFtUtxoAmountExceed) {\n            throw err;\n        }\n\n        // 如果 bsv utxo 先 merge bsv utxo\n        if (isBsvAmountExceed) {\n            try {\n                await mergeBsvUtxo(network, senderWif)\n                await sleep(3000)\n            } catch (err) {\n                console.log('merge bsv utxo fail')\n                console.error(err)\n                throw err\n            }\n\n            // merge 后重新发起 ft transfer 交易\n            try {\n                const {txid, tx} = await ft.transfer({\n                    senderWif: senderWif,\n                    receivers,\n                    codehash,\n                    genesis,\n                })\n                util.checkFeeRate(tx)\n                const txParseRes = parseTransaction(network, tx.serialize(true))\n                return {\n                    txid,\n                    outputs: txParseRes.outputs,\n                }\n            } catch (_err) {\n                const err = mapBsvFeeError(_err)\n                console.log('ft transfer fail after bsv utxo merge')\n                console.error(err)\n                const errMsg = err.toString()\n                isFtUtxoAmountExceed = errMsg.indexOf('Too many token-utxos') > 0;\n                if (!isFtUtxoAmountExceed) {\n                    throw err\n                }\n            }\n        }\n\n        if (isFtUtxoAmountExceed) {\n            // merge utxo\n            try {\n                const {tx} = await ft.merge({\n                    ownerWif: senderWif,\n                    codehash,\n                    genesis,\n                })\n                util.checkFeeRate(tx)\n                await sleep(3000)\n            } catch (err) {\n                console.log('merge ft utxo fail')\n                console.error(err)\n                throw err\n            }\n\n            // merge 后重新发起 ft transfer 交易\n            try {\n                const {txid, tx} = await ft.transfer({\n                    senderWif: senderWif,\n                    receivers,\n                    codehash,\n                    genesis,\n                })\n                util.checkFeeRate(tx)\n                const txParseRes = parseTransaction(network, tx.serialize(true))\n                return {\n                    txid,\n                    outputs: txParseRes.outputs,\n                }\n            } catch (_err) {\n                const err = mapBsvFeeError(_err)\n                console.log('ft transfer fail after ft utxo merge')\n                console.error(err)\n                throw err\n            }\n        }\n    } \n}\n\nconst Signature = bsv.crypto.Signature;\nexport const sighashType = Signature.SIGHASH_ALL | Signature.SIGHASH_FORKID;\n\n\n// p2pkh 解锁\nexport function unlockP2PKHInput(privateKey: bsv.PrivateKey, tx: bsv.Transaction, inputIndex: number, sigtype: number) {\n    const sig = new bsv.Transaction.Signature({\n      publicKey: privateKey.publicKey,\n      prevTxId: tx.inputs[inputIndex].prevTxId,\n      outputIndex: tx.inputs[inputIndex].outputIndex,\n      inputIndex,\n      signature: bsv.Transaction.Sighash.sign(\n        tx,\n        privateKey,\n        sigtype,\n        inputIndex,\n        tx.inputs[inputIndex].output.script,\n        tx.inputs[inputIndex].output.satoshisBN\n      ),\n      sigtype,\n    });\n  \n    tx.inputs[inputIndex].setScript(\n      bsv.Script.buildPublicKeyHashIn(\n        sig.publicKey,\n        sig.signature.toDER(),\n        sig.sigtype\n      )\n    );\n  }\n\n// 发送 bsv 交易\nfunction checkBsvReceiversSatisfied(receivers: TransferReceiver[], tx: any, network: NetWork) {\n    let satified = true\n    const txAddressAmountMap: {[key: string]: number} = {}\n    const getKey = (address: string, amount: any) => {\n        return `${address}_${util.toString(amount)}`\n    }\n    tx.outputs.forEach((output: any) => {\n        const address = output.script.toAddress(network);\n        const amount = output.satoshis\n        const key = getKey(address, amount)\n        txAddressAmountMap[key] = (txAddressAmountMap[key] || 0) + 1\n    })\n    for (let i = 0; i < receivers.length; i++) {\n        const rece = receivers[i]\n        const key = getKey(rece.address, rece.amount)\n        if (!txAddressAmountMap[key]) {\n            satified = false\n            break\n        }\n        txAddressAmountMap[key] = txAddressAmountMap[key] - 1\n    }\n    return satified\n}\nexport async function transferBsv(network: NetWork, senderWif: string, receivers: TransferReceiver[]) {\n    // 1. 获取用户 utxo 列表\n    // 2. 判断 utxo 金额 是否 满足 receivers 金额\n    // 3. 构造交易\n    // 4. 广播交易\n    console.log('arguments', network, senderWif, receivers)\n    const address = new bsv.PrivateKey(senderWif, network).toAddress(network)\n    const balance = await getAddressBsvBalanceByUtxo(network, address)\n    const totalOutput = receivers.reduce((prev: any, cur) => util.plus(prev, cur.amount), '0')\n    if (util.lessThan(balance, totalOutput)) {\n        throw new Error('Insufficient_bsv_Balance')\n    }\n    let utxoValue: string = '0'\n    let selectedUtxoList = []\n\n    const tx = new bsv.Transaction()\n    tx.feePerKb(500)\n    const dust = 456\n\n    // input = output + fee + change\n    // 异常情况: 加上 change 后, fee 增加, 原本 input 不够了, 此时将所有输出移除, 然后，暂不考虑\n    \n    for (let page = 1; ;page++) {\n        const utxoResList = await getAddressBsvUtxoList(network, address, page)\n        for (let i = 0; i < utxoResList.length; i++) {\n            const item = utxoResList[i]\n            utxoValue = util.plus(utxoValue, item.satoshis)\n            selectedUtxoList.push(item)\n            tx.addInput(\n                new bsv.Transaction.Input.PublicKeyHash({\n                    output: new bsv.Transaction.Output({\n                        script: bsv.Script.buildPublicKeyHashOut(item.address),\n                        satoshis: item.satoshis,\n                    }),\n                    prevTxId: item.txId,\n                    outputIndex: item.outputIndex,\n                    script: bsv.Script.empty(),\n                })\n            );\n            if (util.lessThanEqual(util.plus(totalOutput, dust), utxoValue)) {\n                break\n            }\n        }\n        if (util.lessThanEqual(util.plus(totalOutput, dust), utxoValue)) {\n            break\n        }\n        if (utxoResList.length <= 0 ) {\n            break\n        }\n    }\n    receivers.forEach(item => {\n        tx.to(item.address, +item.amount)\n    })\n    if (util.greaterThan(util.minus(utxoValue, +totalOutput), 0)) {\n        tx.change(address)\n    }\n    // 如果 (utxo输入 - fee - 所有输出) = 找零 < dust，那么全部转出\n    if (util.lessThan(util.minus(utxoValue, tx.getFee(), totalOutput), dust)) {\n        // 全部转出\n        tx.clearOutputs()\n        receivers.forEach((item, index) => {\n            \n            if (receivers.length === index + 1) {\n                // 最后一个使用 change\n                tx.change(item.address)\n            } else {\n                tx.to(item.address, +item.amount)\n            }\n        })\n    }\n    tx.inputs.forEach((_: any, inputIndex: number) => {\n        const privateKey = new bsv.PrivateKey(senderWif)\n        unlockP2PKHInput(privateKey, tx, inputIndex, sighashType);\n    });\n    util.checkFeeRate(tx)\n    const txid = await broadcastSensibleQeury(network, tx.serialize())\n    const txParseRes = parseTransaction(network, tx.serialize(true))\n\n    const amountSatified = checkBsvReceiversSatisfied(receivers, tx, network)\n    if (!amountSatified) {\n        console.log(util.safeJsonStringify({\n            type: 'bsvTransferAmountNotSatified',\n            txid: tx.hash,\n            receivers,\n            outputs: txParseRes.outputs,\n        }))\n        Sentry.captureMessage(`bsvTransferAmountNotSatified_${address}_${tx.hash}`);\n    }\n    return {\n        txid,\n        outputs: txParseRes.outputs,\n        fee: tx.getFee()\n    }\n}\n\n// 合并 bsv utxo, 合并一页\nexport async function mergeBsvUtxo(network: NetWork, senderWif: string) {\n    const address = new bsv.PrivateKey(senderWif, network).toAddress(network)\n    const utxolist = await getAddressBsvUtxoList(network, address, 1)\n    const tx = new bsv.Transaction()\n    tx.feePerKb(500)\n    utxolist.forEach(item => {\n        tx.addInput(new bsv.Transaction.Input.PublicKeyHash({\n            output: new bsv.Transaction.Output({\n                script: bsv.Script.buildPublicKeyHashOut(item.address),\n                satoshis: item.satoshis,\n            }),\n            prevTxId: item.txId,\n            outputIndex: item.outputIndex,\n            script: bsv.Script.empty(),\n        }))\n    })\n    tx.change(address)\n    tx.inputs.forEach((_: any, inputIndex: number) => {\n        const privateKey = new bsv.PrivateKey(senderWif)\n        unlockP2PKHInput(privateKey, tx, inputIndex, sighashType)\n    })\n    util.checkFeeRate(tx)\n    const txid = await broadcastSensibleQeury(network, tx.serialize())\n    const txParseRes = parseTransaction(network, tx.serialize(true))\n    return {\n        txid,\n        outputs: txParseRes.outputs,\n    }\n}\n\n// 合并 sensible ft\nexport async function mergeSensibleFt(network: NetWork) {}\n\nconst hasProtoFlag = function (scriptBuffer: any) {\n    const flag = protoHeader.getFlag(scriptBuffer);\n    if (flag.compare(protoHeader.PROTO_FLAG) === 0) {\n      return true;\n    }\n    return false;\n};\n\n\nconst parseTokenContractScript = function (scriptBuf: any, network: any = \"mainnet\") {\n    const hasSensibleFlag = hasProtoFlag(scriptBuf);\n    if (!hasSensibleFlag) {\n      return null;\n    }\n    const dataPart = tokenProto.parseDataPart(scriptBuf);\n    const tokenAddress = new bsv.Address(\n      Buffer.from(dataPart.tokenAddress!, \"hex\"),\n      network\n    ).toString();\n    // const genesis = getGenesis(dataPart.sensibleID!.txid, dataPart.sensibleID!.index);\n    const genesis = toHex(tokenProto.getTokenID(scriptBuf));\n    const codehash = getCodeHash(new bsv.Script(scriptBuf));\n    return {\n      ...dataPart,\n      genesis,\n      codehash,\n      tokenAddress,\n    };\n};\n\n\n\nexport function parseTransaction(network: NetWork, rawtx: string) {\n    let tx\n    try {\n        tx = new bsv.Transaction(rawtx)\n    } catch (err) {\n        return {\n            error: err.message\n        }\n    }\n\n    const inputs = tx.inputs.map((input: any, index: number) => {\n        const ftToken: any = parseTokenContractScript(input.script.toBuffer(), network);\n\n        let ret: any = {\n            index: index,\n            prevTxId: input.prevTxId.toString('hex'),\n            outputIndex: input.outputIndex,\n            script: input.script.toString('hex'),\n        }\n        try {\n            const addr = input.script.toAddress(network);\n            if (addr) {\n                ret.address = addr.toString()\n            }\n        } catch (err) {}\n        if (!ftToken) {\n            return ret\n        }\n        if (ftToken.tokenAmount <= 0) {\n            return ret\n        }\n        ret = {\n            ...ret,\n            isFt: true,\n            ftDetail: {\n                genesis: ftToken.genesis,\n                codehash: ftToken.codehash,\n                address: ftToken.tokenAddress,\n                decimal: ftToken.decimalNum,\n                name: ftToken.tokenName,\n                symbol: ftToken.tokenSymbol,\n            }\n        }\n        return ret\n    })\n    const outputs = tx.outputs.map((output: any, index: number) => {\n        const ftToken: any = parseTokenContractScript(output.script.toBuffer(), network);\n        let ret: any = {\n            index: index,\n            satoshis: output.satoshis,\n            script: output.script.toString('hex')\n        }\n        try {\n            const addr = output.script.toAddress(network);\n            if (addr) {\n                ret.address = addr.toString()\n            }\n        } catch (err) {}\n        if (!ftToken) {\n            return ret\n        }\n        if (ftToken.tokenAmount <= 0) {\n            return ret\n        }\n        ret = {\n            ...ret,\n            isFt: true,\n            ftDetail: {\n                genesis: ftToken.genesis,\n                codehash: ftToken.codehash,\n                address: ftToken.tokenAddress,\n                decimal: ftToken.decimalNum,\n                name: ftToken.tokenName,\n                symbol: ftToken.tokenSymbol,\n                amount: ftToken.tokenAmount,\n            }\n        }\n        return ret\n    })\n\n    return {\n        inputs: inputs,\n        outputs: outputs,\n        txid: tx.hash,\n    }\n    \n}","import { createGlobalState } from \"react-hooks-global-state\";\nimport {State, SensibleSatotx} from './stateType'\n\nconst defaultSatotx: SensibleSatotx = {\n    satotxApiPrefix: 'https://api.satotx.com', \n    satotxPubKey: '25108ec89eb96b99314619eb5b124f11f00307a833cda48f5ab1865a04d4cfa567095ea4dd47cdf5c7568cd8efa77805197a67943fe965b0a558216011c374aa06a7527b20b0ce9471e399fa752e8c8b72a12527768a9fc7092f1a7057c1a1514b59df4d154df0d5994ff3b386a04d819474efbd99fb10681db58b1bd857f6d5'\n}\n\n// app state\nconst initialState: State = {\n    account: null,\n    key: null,\n    bsvBalance: null,\n    sensibleFtList: [],\n    satotxConfigMap: new Map()\n};\ninitialState.satotxConfigMap.set(\n    '5b3bfa8e7600d701e70551075573ea28fd16c25a39fe2bdafdc3e08b11ca76b800000000', \n    [defaultSatotx, defaultSatotx, defaultSatotx]\n)\nconst { useGlobalState, getGlobalState, setGlobalState } = createGlobalState(initialState);\n\nexport {\n    useGlobalState,\n    getGlobalState,\n    setGlobalState,\n    defaultSatotx,\n}\n","import {setGlobalState, getGlobalState } from './state'\nimport {generateKeysFromEmailPassword, getAddressSensibleFtList, getAddressBsvBalanceByUtxo} from '../lib'\nimport {Account, BalanceBsv, Key, SensibleFt} from './stateType'\nimport * as createPostMsg from 'post-msg';\n\n// local account storage\nconst accountStorageKey = 'accountStorageKey'\n// localStorage.removeItem(accountStorageKey)\nfunction saveAccountStorage(account: Account | null) {\n    const str = account ? JSON.stringify(account) : ''\n    localStorage.setItem(accountStorageKey, str)\n    // do not save account !!!\n}\nfunction getAccountStorage(): Account | null {\n    const str = localStorage.getItem(accountStorageKey)\n    if (!str) {\n        return null\n    }\n    return JSON.parse(str)\n}\n\nfunction isSupportToken(codehash: String) {\n    return codehash === '514776383faa66e4a65808904d4d6724e4774fbe'\n}\n\n// app action\nlet pollingBsvTimer = 0\nlet pollingSensibleFtTimer = 0\nexport async function pollingBsvBalance(){\n    clearInterval(pollingBsvTimer)\n    const fn = async () => {\n        const account = getGlobalState('account')\n        const key = getGlobalState('key')\n        if (!account || !key) {\n            return\n        }\n        try {\n            const balance = await getAddressBsvBalanceByUtxo(account.network, key.address)\n            setGlobalState('bsvBalance', {balance})\n        } catch (err) {\n            console.log('getAddressBsvBalance err', account.network, key.address, err)\n        }\n    }\n    await fn()\n    pollingBsvTimer = window.setInterval(fn, 5000)\n}\nexport async function pollingSensibleFtBalance() {\n    clearInterval(pollingSensibleFtTimer)\n    const fn = async () => {\n        const account = getGlobalState('account')\n        const key = getGlobalState('key')\n        if (!account || !key) {\n            return\n        }\n        try {\n            const sensibleFtList = await getAddressSensibleFtList(account.network, key.address)\n            const valid_sensibleFtList = sensibleFtList.filter(item => isSupportToken(item.codehash));\n            setGlobalState('sensibleFtList', valid_sensibleFtList);\n        } catch (err) {\n            console.log('getAddressSensibleFtList err', account.network, key.address, err)\n        }\n    }\n    await fn()\n    pollingSensibleFtTimer = window.setInterval(fn, 5000)\n}\n\nexport async function saveAccount(account: Account | null) {\n    saveAccountStorage(account)\n    if (account) {\n        const key = generateKeysFromEmailPassword(account.email, account.password, account.network)\n        setGlobalState('account', account)\n        setGlobalState('key', key)\n        await pollingSensibleFtBalance()\n        pollingBsvBalance()\n    } else {\n        setGlobalState(\"account\", null)\n        setGlobalState('key', null)\n    }\n}\n\nexport function recoverAccountFromStorage() {\n    const account = getAccountStorage()\n    saveAccount(account)\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms))\n\n// iframe action\nexport async function runIframeTask() {\n    if (window === window.top) {\n        return\n    }\n    const hashdata = JSON.parse(decodeURIComponent(window.location.hash.substr(1)))\n    const postMsg = createPostMsg(window.top, '*')\n    const id = hashdata.id\n\n    let preAccount: Account | null = null\n    let preBsvBalance: BalanceBsv | null = null\n    let preSensibleFtBalance: SensibleFt[] = []\n    let accountKey: Key | null = null\n    // let lastBsvBalance: \n\n    postMsg.emit(id, {\n        type: 'ready'\n    })\n\n    const isBsvBalanceEqual = (b1: BalanceBsv | null, b2: BalanceBsv | null) => {\n        if (!b1 && !b2) {\n            return true\n        }\n        return b1?.balance === b2?.balance\n    }\n    const isSensibleFtBalanceEqual = (b1: SensibleFt[], b2: SensibleFt[]) => {\n        if (b1.length !== b2.length) {\n            return false\n        }\n        b1.sort((item1, item2) => item1.genesis.localeCompare(item2.genesis))\n        b2.sort((item1, item2) => item1.genesis.localeCompare(item2.genesis))\n\n        for (let i = 0; i < b1.length; i++) {\n            const item1 = b1[i]\n            const item2 = b2[i]\n            if (item1.genesis !== item2.genesis) {\n                return false\n            }\n            if (item1.balance !== item2.balance) {\n                return false\n            }\n        }                \n        return true\n    }\n    const isAccountEqual = (b1: Account | null, b2: Account | null) => {\n        return (\n            b1?.email === b2?.email &&\n            b1?.network === b2?.network &&\n            b1?.password === b2?.password\n        )\n    }\n    const requestLatestData = async () => {\n        const latestAccount = getAccountStorage()\n        if (!(isAccountEqual(latestAccount, preAccount))) {\n            postMsg.emit(id, {\n                type: 'account',\n                data: latestAccount\n            })\n        }\n        preAccount = latestAccount;\n        if (preAccount) {\n            // get balance\n            accountKey = generateKeysFromEmailPassword(preAccount.email, preAccount.password, preAccount.network)\n            try {\n                const latestBalance = await getAddressBsvBalanceByUtxo(preAccount.network, accountKey.address)\n                const equal = isBsvBalanceEqual(preBsvBalance, {balance: latestBalance})\n                preBsvBalance = {balance: latestBalance}\n                if (!equal) {\n                    postMsg.emit(id, {\n                        type: 'bsvBalance', \n                        data: preBsvBalance,\n                    })\n                }\n            } catch (err) {}\n            try {\n                const latestBalance = await getAddressSensibleFtList(preAccount.network, accountKey.address)\n                const equal = isSensibleFtBalanceEqual(preSensibleFtBalance, latestBalance)\n                preSensibleFtBalance = latestBalance\n                if (!equal) {\n                    postMsg.emit(id, {\n                        type: 'sensibleFtBalance',\n                        data: preSensibleFtBalance\n                    })\n                }\n            } catch (err) {}\n            return true\n        } else {\n            return false\n        }\n    }\n\n    const handleRequest = (method: string, fn: Function) => {\n        postMsg.on(id, async function (_: any, eventData: any) {\n            const {type, data} = eventData\n            if (type === 'request' && data?.method === method) {\n                const requestId = data.requestId\n                try {\n                    const res = await fn(data.params)\n                    postMsg.emit(id, {\n                        type: 'response',\n                        data: {\n                            requestId,\n                            method,\n                            response: res,\n                        }\n                    })\n                } catch (err) {\n                    postMsg.emit(id, {\n                        type: 'response',\n                        data: {\n                            requestId,\n                            method,\n                            error: err.toString()\n                        }\n                    })\n                }\n            }\n        })\n    }\n\n    handleRequest('getAccount', async () => {\n        await requestLatestData()\n        if (!preAccount) {\n            return null\n        }\n        return {\n            name: preAccount.email,\n            email: preAccount.email,\n            network: preAccount.network,\n        }\n    });\n    handleRequest('getBsvBalance', async () => {\n        await requestLatestData()\n        return preBsvBalance\n    })\n    handleRequest('getSensibleFtBalance', async () => {\n        await requestLatestData()\n        return preSensibleFtBalance\n    })\n    handleRequest('getAddress', async () => {\n        await requestLatestData()\n        if (!accountKey) {\n            return null\n        }\n        return accountKey.address\n    })\n    handleRequest('logout', async () => {\n        saveAccountStorage(null)\n    })\n    handleRequest('ping', () => {\n        return null;\n    })\n\n    for (;;) {\n        const signed = await requestLatestData()\n        await sleep(signed ? 3000 : 500)\n    }\n\n}","import { useRef, useEffect } from \"react\";\n\nexport function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  useEffect(() => {\n    savedCallback.current = callback;\n  });\n\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n\n    let id = setInterval(tick, delay);\n    return () => clearInterval(id);\n  }, [delay]);\n}\n\nexport function useOnceCall(cb, condition = true) {\n  const isCalledRef = useRef(false);\n  useEffect(() => {\n    if (condition && !isCalledRef.current) {\n      isCalledRef.current = true;\n      cb();\n    }\n  }, [cb, condition]);\n}\n","import {\n  Button,\n  Popover,\n  Card,\n  Form,\n  Input,\n  Select,\n  List,\n  Row,\n  Col,\n  message,\n  InputNumber,\n  Space,\n  Modal,\n} from \"antd\";\nimport {\n  UserOutlined,\n  LockOutlined,\n  MinusOutlined,\n  PlusOutlined,\n  LeftOutlined,\n} from \"@ant-design/icons\";\nimport { useState, useEffect } from \"react\";\nimport * as QRCode from \"qrcode.react\";\nimport {\n  getWocAddressUrl,\n  formatValue,\n  isValidAddress,\n  transferBsv,\n  transferSensibleFt,\n  getWocTransactionUrl,\n  getSensibleFtHistoryUrl,\n  parseTransaction,\n} from \"./lib\";\nimport * as createPostMsg from \"post-msg\";\nimport { useGlobalState, defaultSatotx } from \"./state/state\";\nimport * as actions from \"./state/action\";\nimport { useOnceCall } from \"./hooks\";\nimport \"./App.css\";\nimport * as util from \"./lib/util\";\nimport * as Sentry from \"@sentry/react\";\nimport axios from 'axios';\n\nconst sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\nconst { Option } = Select;\n\nfunction Header() {\n  const [account] = useGlobalState(\"account\");\n  const [key] = useGlobalState(\"key\");\n  const [decodeModalVisible, setDecodeModalVisible] = useState(false);\n  const [rawtx, setRawtx] = useState(\"\");\n  const [network, setNetwork] = useState(\"\");\n  const [resultModalVisible, setResultModalVisible] = useState(false);\n\n  const handleLogout = () => {\n    actions.saveAccount(null);\n  };\n  const handleHistory = () => {\n    let url = getWocAddressUrl(account.network, key.address);\n    window.open(url);\n  };\n  const handleSourceCode = () => {\n    window.open(\"http://github.com\");\n  };\n\n  const decodeTx = () => {\n    const res = parseTransaction(network, rawtx);\n    console.log(\"decodeTx res\", res);\n  };\n\n  return (\n    <div className=\"header\">\n      <div className=\"logo\">Web Wallet</div>\n      {account && (\n        <Popover\n          title=\"\"\n          content={\n            <>\n              <Button type=\"link\" onClick={handleLogout}>\n                Logout\n              </Button>\n              <br />\n              <Button type=\"link\" onClick={handleHistory}>\n                History\n              </Button>\n              <br />\n              <Button type=\"link\" onClick={handleSourceCode}>\n                Source Code\n              </Button>\n              <br />\n              <Button type=\"link\" onClick={() => setDecodeModalVisible(true)}>\n                decode rawtx\n              </Button>\n            </>\n          }\n        >\n          <Button type=\"link\">{account.email}</Button>\n        </Popover>\n      )}\n      <Modal\n        visible={decodeModalVisible}\n        onCancel={() => setDecodeModalVisible(false)}\n      >\n        <Input.TextArea\n          rows={4}\n          value={rawtx}\n          onChange={(e) => setRawtx(e.target.value)}\n        ></Input.TextArea>\n        <Select\n          style={{ width: 180 }}\n          placeholder=\"Select network\"\n          value={network}\n          onChange={(value) => setNetwork(value)}\n        >\n          <Option value=\"mainnet\">mainnet</Option>\n          <Option value=\"testnet\">testnet</Option>\n        </Select>\n        <Button type=\"primary\" onClick={decodeTx}>\n          decode\n        </Button>\n      </Modal>\n      <Modal\n        visible={resultModalVisible}\n        onCancel={() => setResultModalVisible(false)}\n      ></Modal>\n    </div>\n  );\n}\n\nfunction LoginPanel() {\n  const [account] = useGlobalState(\"account\");\n  const [form] = Form.useForm();\n\n  const handleOnFinish = () => {\n    Modal.confirm({\n      title: \"安全注意\",\n      content: (\n        <div>\n          Web钱包的私钥是通过用户的邮箱和密码实时计算得到，不会上传服务器，也不会保存在本地(代码见\n          <a\n            href=\"https://github.com/klouskingsley/bsv-web-wallet\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            github\n          </a>\n          )。仅供方便用户测试之用，不适合存放大量资金，建议用户妥善保管邮箱+密码组合以防资金丢失，或在使用完成之后将剩余资金转移。邮箱+密码组合丢失(忘记，被盗等情形)会导致资产丢失\n        </div>\n      ),\n      onOk: () => {\n        const account = form.getFieldsValue();\n        actions.saveAccount(account);\n      },\n    });\n  };\n  if (account) {\n    return null;\n  }\n\n  return (\n    <Card className=\"card\" title=\"Login\" bordered={false}>\n      <Form form={form} layout=\"vertical\" onFinish={handleOnFinish}>\n        <Form.Item\n          name=\"email\"\n          rules={[\n            {\n              type: \"email\",\n              required: true,\n              message: \"Please input a valid Email!\",\n            },\n          ]}\n        >\n          <Input\n            prefix={<UserOutlined className=\"site-form-item-icon\" />}\n            placeholder=\"Email\"\n          />\n        </Form.Item>\n        <Form.Item\n          name=\"password\"\n          rules={[\n            { required: true, message: \"Please input your Password!\" },\n            {\n              min: 6,\n              message: \"Password at least 6 chars\",\n              transform: (value) => value && value.trim(),\n            },\n          ]}\n        >\n          <Input.Password\n            prefix={<LockOutlined className=\"site-form-item-icon\" />}\n            type=\"password\"\n            visibilityToggle={true}\n            placeholder=\"Password\"\n          />\n        </Form.Item>\n        <Form.Item name=\"network\" label=\"Network\" rules={[{ required: true }]}>\n          <Select placeholder=\"Select network\">\n            <Option value=\"mainnet\">mainnet</Option>\n            <Option value=\"testnet\">testnet</Option>\n          </Select>\n        </Form.Item>\n        <Form.Item>\n          说明：Web钱包的私钥是通过用户的邮箱和密码实时计算得到(无需注册)，每次输入相同的邮箱和密码登录即可计算出相同的私钥，私钥不会上传服务器，也不会保存在本地，仅供方便用户测试之用，不适合存放大量资金，建议用户妥善保管邮箱+密码组合以防资金丢失。\n        </Form.Item>\n        <Form.Item>\n          <Button\n            type=\"primary\"\n            htmlType=\"submit\"\n            className=\"login-form-button\"\n          >\n            Log in\n          </Button>\n        </Form.Item>\n      </Form>\n    </Card>\n  );\n}\n\nfunction AccountInfoPanel({ onWithDraw, onTransfer }) {\n  const [key] = useGlobalState(\"key\");\n  const [account] = useGlobalState(\"account\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n\n  if (!key || !account) {\n    return null;\n  }\n  const handleHistory = () => {\n    let url = getWocAddressUrl(account.network, key.address);\n    window.open(url);\n  };\n  const handleTransfer = (genesis) => {\n    if (!genesis) {\n      return onTransfer(\"\");\n    }\n    // if (!satotxConfigMap.has(genesis)) {\n    //   return message.error(\"rabin api not set or found\");\n    // }\n    return onTransfer(genesis);\n  };\n  return [\n    <Card\n      className=\"card\"\n      title=\"Account Info\"\n      bordered={false}\n      actions={\n        <>\n          <Button type=\"link\" onClick={handleHistory}>\n            history\n          </Button>\n          ,\n          <Button type=\"link\" onClick={onWithDraw}>\n            withdraw\n          </Button>\n          ,\n        </>\n      }\n    >\n      <Form layout=\"vertical\">\n        <Form.Item label={`${account.network} address`}>\n          <Input value={key.address} />\n          <div style={{ margin: 20 }}>\n            <QRCode value={key.address} />\n          </div>\n        </Form.Item>\n        <Form.Item label=\"privateKey\">\n          <Input.Password visibilityToggle={true} value={key.privateKey} />\n        </Form.Item>\n      </Form>\n    </Card>,\n    <Card className=\"card\" title=\"Asset\" bordered={false}>\n      <Form layout=\"vertical\">\n        {bsvBalance && (\n          <Form.Item label=\"BSV balance\">\n            <Row justify=\"space-between\">\n              <Col span={16}>\n                <div>{formatValue(bsvBalance.balance, 8)}</div>\n              </Col>\n              <Col span={7}>\n                <Button type=\"link\" onClick={() => handleTransfer(\"\")}>\n                  Transfer BSV\n                </Button>\n              </Col>\n            </Row>\n          </Form.Item>\n        )}\n        {sensibleFtList.length > 0 && (\n          <Form.Item label=\"Sensible Fungible Token\">\n            <List\n              itemLayout=\"horizontal\"\n              dataSource={sensibleFtList}\n              renderItem={(item) => {\n                return (\n                  <List.Item\n                    key={item.genesis}\n                    actions={\n                      <>\n                        <Popover\n                          placement=\"topRight\"\n                          content={\n                            <>\n                              <div>codehash: {item.codehash}</div>,\n                              <div>genesis: {item.genesis}</div>,\n                            </>\n                          }\n                        >\n                          <a\n                            key=\"list-loadmore-more\"\n                            href={getSensibleFtHistoryUrl(\n                              account.network,\n                              key.address,\n                              item.genesis,\n                              item.codehash\n                            )}\n                            rel=\"noreferrer\"\n                            target=\"_blank\"\n                          >\n                            more info\n                          </a>\n                        </Popover>\n                      </>\n                    }\n                  >\n                    <List.Item.Meta\n                      title={item.tokenSymbol}\n                      description={item.tokenName}\n                    />\n                    <Row>\n                      <Col>\n                        <div\n                          style={{\n                            height: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                          }}\n                        >\n                          Balance:{\" \"}\n                          {formatValue(item.balance, item.tokenDecimal)}\n                        </div>\n                      </Col>\n                      <Col>\n                        <Button\n                          type=\"link\"\n                          onClick={() => handleTransfer(item.genesis)}\n                        >\n                          Go Transfer\n                        </Button>\n                      </Col>\n                    </Row>\n                  </List.Item>\n                );\n              }}\n            ></List>\n          </Form.Item>\n        )}\n      </Form>\n    </Card>,\n  ];\n}\n\nfunction getRabinPubKeys(url) {\n  return axios.get(url);\n}\n\nasync function getRabins(rabinApis = []) {\n  let promises = [], rabins = [];\n  rabinApis.forEach(rabinApi => {\n    promises.push(getRabinPubKeys(rabinApi));\n  })\n  return new Promise(resolve => {\n    axios.all(promises).then(res => {\n      // console.log(res);\n      res.forEach((item, index) => {\n        rabins.push({\n          satotxApiPrefix: rabinApis[index],\n          satotxPubKey: item.data.data.pubKey\n        })\n      })\n\n      resolve(rabins);\n    })\n  })\n\n}\n\nfunction TransferAllPanel({ initDatas = [], onCancel, onTransferCallback }) {\n  const [key] = useGlobalState(\"key\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [account] = useGlobalState(\"account\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n  const [satotxConfigMap] = useGlobalState(\"satotxConfigMap\");\n  const [form] = Form.useForm();\n  const [loading, setLoading] = useState(false);\n\n  useOnceCall(() => {\n    const values = {};\n    initDatas.forEach((data, index) => {\n      const isBsv = !data.genesis;\n      const token = sensibleFtList.find(\n        (item) => item.genesis === data.genesis\n      );\n      const decimal = isBsv ? 8 : token.tokenDecimal;\n      values[`receiverList${index}`] = data.receivers.map((item) => {\n        return {\n          address: item.address,\n          amount: util.div(item.amount, util.getDecimalString(decimal)),\n        };\n      });\n    });\n    form.setFieldsValue(values);\n  }, key && bsvBalance);\n\n  if (!key) {\n    return null;\n  }\n  if (!bsvBalance) {\n    return null;\n  }\n\n  const handleSubmit = async () => {\n    const receiverLists = form.getFieldsValue();\n\n    const broadcastBsv = async ({ formatReceiverList }) => {\n      setLoading(true);\n      let transferRes;\n      let txid = \"\";\n      try {\n        const res = await await transferBsv(\n          account.network,\n          key.privateKey,\n          formatReceiverList\n        );\n        transferRes = res;\n        txid = res.txid;\n      } catch (err) {\n        const msg = \"broadcast error: \" + err.toString();\n        Sentry.captureException(err);\n        Sentry.captureMessage(`bsvTransferFail_${key.address}`);\n        onTransferCallback({\n          error: msg,\n        });\n        console.log(\"broadcast bsv error \");\n        console.error(err);\n        message.error(err.toString());\n      }\n      Sentry.captureMessage(`bsvTransferSuccess_${key.address}_${txid}`);\n      return transferRes;\n    };\n\n    const broadcastSensibleFt = async ({\n      formatReceiverList,\n      token,\n      decimal,\n      genesis,\n      rabinApis\n    }) => {\n      setLoading(true);\n      let transferRes;\n      try {\n        const signers = satotxConfigMap.get(genesis) || [\n          defaultSatotx,\n          defaultSatotx,\n          defaultSatotx,\n        ];\n\n        const rabins = await getRabins(rabinApis);\n        const res = await transferSensibleFt(\n          account.network,\n          // signers,\n          rabins,\n          key.privateKey,\n          formatReceiverList,\n          token.codehash,\n          token.genesis\n        );\n        transferRes = res;\n      } catch (err) {\n        Sentry.captureException(err);\n        Sentry.captureMessage(\n          `ftTransferFail_${key.address}_${token.genesis}_${token.genesis}`\n        );\n        onTransferCallback({\n          error: \"broadcast sensible ft error, \" + err.toString(),\n        });\n        console.log(\"broadcast sensible ft error \");\n        console.error(err);\n        message.error(err.toString());\n      }\n      return transferRes;\n    };\n\n    const broadcastAll = async () => {\n      const transferRes = [];\n      for (let i = 0; i < initDatas.length; i++) {\n        const data = initDatas[i];\n        const isBsv = !data.genesis;\n        const token = sensibleFtList.find(\n          (item) => item.genesis === data.genesis\n        );\n        const decimal = isBsv ? 8 : token.tokenDecimal;\n        const balance = isBsv ? bsvBalance.balance : token.balance;\n        const rabinApis = data.rabinApis;\n        const totalOutputValueFloatDuck = receiverLists[\n          `receiverList${i}`\n        ].reduce((prev, cur) => util.plus(prev, cur.amount), 0);\n\n        const totalOutputValue = util.multi(\n          totalOutputValueFloatDuck,\n          util.getDecimalString(decimal)\n        );\n        if (util.lessThan(balance, totalOutputValue)) {\n          const msg = \"Insufficient ft balance\";\n          onTransferCallback({\n            error: msg,\n          });\n          return message.error(msg);\n        }\n        const formatReceiverList = data.receivers.map((item) => {\n          return {\n            address: item.address,\n            // amount: util.multi(item.amount, util.getDecimalString(decimal)),\n            amount: item.amount,\n          };\n        });\n        const res = isBsv\n          ? await broadcastBsv({ formatReceiverList })\n          : await broadcastSensibleFt({\n              formatReceiverList,\n              token,\n              decimal,\n              genesis: data.genesis,\n              rabinApis\n            });\n        transferRes.push(res);\n        if(i < initDatas.length - 1) {\n          await sleep(2000);\n        }\n      }\n\n      setLoading(false);\n      onTransferCallback({\n        response: {\n          ...transferRes,\n        },\n      });\n    };\n\n    Modal.confirm({\n      title: \"Confirm the transaction\",\n      onOk: () => {\n        broadcastAll();\n      },\n    });\n  };\n  const handleBack = () => {\n    onCancel();\n  };\n  return (\n    <Card\n      className=\"card\"\n      title={\n        <div style={{ cursor: \"pointer\" }} onClick={handleBack}>\n          <LeftOutlined />\n          Transfer\n        </div>\n      }\n      loading={loading}\n      bordered={false}\n    >\n      <Form form={form} layout=\"vertical\" onFinish={handleSubmit}>\n        {initDatas.map((data, index) => {\n          const isBsv = !data.genesis;\n          const token = sensibleFtList.find(\n            (item) => item.genesis === data.genesis\n          );\n\n          if (!isBsv && !token) {\n            return null;\n          }\n          const tokenSymbol = isBsv ? \"BSV\" : token.tokenSymbol;\n          const decimal = isBsv ? 8 : token.tokenDecimal;\n          const balance = isBsv ? bsvBalance.balance : token.balance;\n          const formatBalance = formatValue(balance, decimal);\n          const canEdit = !(data.receivers.length > 0);\n          return (\n            <div key={index}>\n              <div className=\"transfer-line\">\n                {isBsv ? `Coin: ${tokenSymbol}` : `Token: ${tokenSymbol}`}\n              </div>\n              {!isBsv && (\n                <div className=\"transfer-line\">Genesis: {token.genesis}</div>\n              )}\n              {!isBsv && (\n                <div className=\"transfer-line\">Codehash: {token.codehash}</div>\n              )}\n              <Row justify=\"space-between\" style={{ margin: \"10px 0\" }}>\n                <Col span={14}>\n                  <div style={{ fontWeight: 700 }}>Input</div>\n                </Col>\n              </Row>\n              <div className=\"transfer-line\">{`Balance: ${formatBalance}`}</div>\n              <div className=\"transfer-line\">{`From Address: ${key.address}`}</div>\n              <Row justify=\"space-between\" style={{ margin: \"10px 0\" }}>\n                <Col span={14}>\n                  <div style={{ fontWeight: 700 }}>Output</div>\n                </Col>\n              </Row>\n              <Form.List name={`receiverList${index}`}>\n                {(fields, { add, remove }) => (\n                  <>\n                    {fields.map((key, name, fieldKey, ...restField) => {\n                      return (\n                        <Space\n                          key={key.fieldKey}\n                          style={{ display: \"flex\", marginBottom: 8 }}\n                          align=\"baseline\"\n                        >\n                          <Form.Item\n                            {...restField}\n                            name={[name, \"address\"]}\n                            fieldKey={[fieldKey, \"address\"]}\n                            rules={[\n                              {\n                                required: true,\n                                message: \"Please input the address\",\n                              },\n                              {\n                                message: \"invalid address\",\n                                validator: (_, value) =>\n                                  isValidAddress(account.network, value)\n                                    ? Promise.resolve()\n                                    : Promise.reject(),\n                              },\n                            ]}\n                          >\n                            <Input\n                              placeholder=\"Input the address\"\n                              disabled={!canEdit}\n                            />\n                          </Form.Item>\n                          <Form.Item\n                            {...restField}\n                            name={[name, \"amount\"]}\n                            fieldKey={[fieldKey, \"amount\"]}\n                            rules={[\n                              {\n                                required: true,\n                                message: \"Please input amount\",\n                              },\n                            ]}\n                          >\n                            <InputNumber\n                              placeholder=\"Amount\"\n                              min={0}\n                              disabled={!canEdit}\n                            />\n                          </Form.Item>\n                          <Button\n                            disabled={!canEdit}\n                            size=\"small\"\n                            onClick={() => remove(name)}\n                            shape=\"circle\"\n                            icon={<MinusOutlined />}\n                          />\n                        </Space>\n                      );\n                    })}\n\n                    <Form.Item>\n                      <Button\n                        type=\"dashed\"\n                        onClick={() => add()}\n                        icon={<PlusOutlined />}\n                        disabled={!canEdit}\n                      >\n                        Add Output\n                      </Button>\n                    </Form.Item>\n                  </>\n                )}\n              </Form.List>\n            </div>\n          );\n        })}\n        <Form.Item>\n          <Button type=\"primary\" htmlType=\"submit\" block>\n            Transfer\n          </Button>\n        </Form.Item>\n      </Form>\n    </Card>\n  );\n}\n\nfunction TransferPanel({\n  genesis = \"\",\n  initReceivers = [],\n  rabinApis = [],\n  onCancel,\n  onTransferCallback,\n}) {\n  const [key] = useGlobalState(\"key\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [account] = useGlobalState(\"account\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n  const [satotxConfigMap] = useGlobalState(\"satotxConfigMap\");\n  const [form] = Form.useForm();\n  const [loading, setLoading] = useState(false);\n  const canEdit = !(initReceivers.length > 0);\n\n  useOnceCall(() => {\n    const isBsv = genesis === \"\";\n    const token = sensibleFtList.find((item) => item.genesis === genesis);\n    const decimal = isBsv ? 8 : token.tokenDecimal;\n    console.log(\n      \"initReceivers\",\n      initReceivers,\n      initReceivers.map((item) => {\n        return {\n          address: item.address,\n          amount: util.multi(item.amount, util.getDecimalString(decimal)),\n        };\n      })\n    );\n    form.setFieldsValue({\n      receiverList: initReceivers.map((item) => {\n        return {\n          address: item.address,\n          amount: util.div(item.amount, util.getDecimalString(decimal)),\n        };\n      }),\n    });\n  }, key && bsvBalance && initReceivers.length);\n\n  if (!key) {\n    return null;\n  }\n  if (!bsvBalance) {\n    return null;\n  }\n  if (genesis && !sensibleFtList.length) {\n    return null;\n  }\n\n  const isBsv = genesis === \"\";\n  const token = sensibleFtList.find((item) => item.genesis === genesis);\n\n  if (!isBsv && !token) {\n    return null;\n  }\n  const tokenSymbol = isBsv ? \"BSV\" : token.tokenSymbol;\n  const decimal = isBsv ? 8 : token.tokenDecimal;\n  const balance = isBsv ? bsvBalance.balance : token.balance;\n  const formatBalance = formatValue(balance, decimal);\n\n  const handleSubmit = async () => {\n    const { receiverList } = form.getFieldsValue();\n    const totalOutputValueFloatDuck = receiverList.reduce(\n      (prev, cur) => util.plus(prev, cur.amount),\n      0\n    );\n\n    const totalOutputValue = util.multi(\n      totalOutputValueFloatDuck,\n      util.getDecimalString(decimal)\n    );\n    if (util.lessThan(balance, totalOutputValue)) {\n      const msg = \"Insufficient ft balance\";\n      onTransferCallback({\n        error: msg,\n      });\n      return message.error(msg);\n    }\n    const formatReceiverList = receiverList.map((item) => {\n      return {\n        address: item.address,\n        amount: util.multi(item.amount, util.getDecimalString(decimal)),\n      };\n    });\n\n    const broadcastBsv = async () => {\n      setLoading(true);\n      let txid = \"\";\n      let transferRes;\n      try {\n        const res = await await transferBsv(\n          account.network,\n          key.privateKey,\n          formatReceiverList\n        );\n        transferRes = res;\n        txid = res.txid;\n      } catch (err) {\n        const msg = \"broadcast error: \" + err.toString();\n        console.log(\n          util.safeJsonStringify({\n            type: \"bsvTransferFail\",\n            msg,\n            account: {\n              network: account.network,\n              address: key.address,\n            },\n            receivers: formatReceiverList,\n          })\n        );\n        Sentry.captureException(err);\n        Sentry.captureMessage(`bsvTransferFail_${key.address}`);\n        onTransferCallback({\n          error: msg,\n        });\n        console.log(\"broadcast bsv error \");\n        console.error(err);\n        message.error(err.toString());\n      }\n      setLoading(false);\n      if (txid) {\n        console.log(\n          util.safeJsonStringify({\n            type: \"bsvTransferSuccess\",\n            account: {\n              network: account.network,\n              address: key.address,\n            },\n            receivers: formatReceiverList,\n            txid,\n            ...transferRes,\n          })\n        );\n        Sentry.captureMessage(`bsvTransferSuccess_${key.address}_${txid}`);\n        onTransferCallback({\n          response: {\n            ...transferRes,\n          },\n        });\n        Modal.success({\n          title: \"Transaction broadcast success\",\n          content: (\n            <div>\n              txid:{\" \"}\n              <a\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                href={getWocTransactionUrl(account.network, txid)}\n              >\n                {txid}\n              </a>\n            </div>\n          ),\n        });\n      }\n    };\n\n    const broadcastSensibleFt = async () => {\n      setLoading(true);\n      let txid = \"\";\n      let transferRes;\n      try {\n        const signers = satotxConfigMap.get(genesis) || [\n          defaultSatotx,\n          defaultSatotx,\n          defaultSatotx,\n        ];\n        const rabins = await getRabins(rabinApis);\n\n        const res = await transferSensibleFt(\n          account.network,\n          // signers,\n          rabins,\n          key.privateKey,\n          formatReceiverList,\n          token.codehash,\n          token.genesis\n        );\n        transferRes = res;\n        txid = res.txid;\n      } catch (err) {\n        console.log(\"broadcast sensible ft error \");\n        console.error(err);\n        message.error(err.toString());\n        console.log(\n          util.safeJsonStringify({\n            type: \"ftTransferFail\",\n            msg: util.safeJsonStringify(err.message),\n            account: {\n              network: account.network,\n              address: key.address,\n            },\n            genesis: token.genesis,\n            codehash: token.codehash,\n            receivers: formatReceiverList,\n          })\n        );\n        Sentry.captureException(err);\n        Sentry.captureMessage(\n          `ftTransferFail_${key.address}_${token.genesis}_${token.genesis}`\n        );\n        onTransferCallback({\n          error: err.toString(),\n        });\n      }\n      setLoading(false);\n      if (txid) {\n        console.log(\n          util.safeJsonStringify({\n            type: \"ftTransferSuccess,\",\n            account: {\n              network: account.network,\n              address: key.address,\n              genesis: token.genesis,\n              codehash: token.codehash,\n            },\n            receivers: formatReceiverList,\n            txid,\n            ...transferRes,\n          })\n        );\n        Sentry.captureMessage(`ftTransferSuccess_${key.address}_${txid}`);\n        onTransferCallback({\n          response: {\n            ...transferRes,\n          },\n        });\n        Modal.success({\n          title: \"Transaction broadcast success\",\n          content: (\n            <div>\n              txid:{\" \"}\n              <a\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                href={getWocTransactionUrl(account.network, txid)}\n              >\n                {txid}\n              </a>\n            </div>\n          ),\n        });\n      }\n    };\n\n    Modal.confirm({\n      title: \"Confirm the transaction\",\n      onOk: () => {\n        isBsv ? broadcastBsv() : broadcastSensibleFt();\n      },\n    });\n  };\n  const handleBack = () => {\n    onCancel();\n  };\n\n  return (\n    <Card\n      className=\"card\"\n      title={\n        <div style={{ cursor: \"pointer\" }} onClick={handleBack}>\n          <LeftOutlined />\n          Transfer\n        </div>\n      }\n      loading={loading}\n      bordered={false}\n    >\n      <Form form={form} layout=\"vertical\" onFinish={handleSubmit}>\n        <div className=\"transfer-line\">\n          {isBsv ? `Coin: ${tokenSymbol}` : `Token: ${tokenSymbol}`}\n        </div>\n        {!isBsv && (\n          <div className=\"transfer-line\">Genesis: {token.genesis}</div>\n        )}\n        {!isBsv && (\n          <div className=\"transfer-line\">Codehash: {token.codehash}</div>\n        )}\n        <Row justify=\"space-between\" style={{ margin: \"10px 0\" }}>\n          <Col span={14}>\n            <div style={{ fontWeight: 700 }}>Input</div>\n          </Col>\n        </Row>\n        <div className=\"transfer-line\">{`Balance: ${formatBalance}`}</div>\n        <div className=\"transfer-line\">{`From Address: ${key.address}`}</div>\n        <Row justify=\"space-between\" style={{ margin: \"10px 0\" }}>\n          <Col span={14}>\n            <div style={{ fontWeight: 700 }}>Output</div>\n          </Col>\n        </Row>\n        <Form.List name=\"receiverList\">\n          {(fields, { add, remove }) => (\n            <>\n              {fields.map((key, name, fieldKey, ...restField) => {\n                return (\n                  <Space\n                    key={key.fieldKey}\n                    style={{ display: \"flex\", marginBottom: 8 }}\n                    align=\"baseline\"\n                  >\n                    <Form.Item\n                      {...restField}\n                      name={[name, \"address\"]}\n                      fieldKey={[fieldKey, \"address\"]}\n                      rules={[\n                        {\n                          required: true,\n                          message: \"Please input the address\",\n                        },\n                        {\n                          message: \"invalid address\",\n                          validator: (_, value) =>\n                            isValidAddress(account.network, value)\n                              ? Promise.resolve()\n                              : Promise.reject(),\n                        },\n                      ]}\n                    >\n                      <Input\n                        placeholder=\"Input the address\"\n                        disabled={!canEdit}\n                      />\n                    </Form.Item>\n                    <Form.Item\n                      {...restField}\n                      name={[name, \"amount\"]}\n                      fieldKey={[fieldKey, \"amount\"]}\n                      rules={[\n                        { required: true, message: \"Please input amount\" },\n                      ]}\n                    >\n                      <InputNumber\n                        placeholder=\"Amount\"\n                        min={0}\n                        disabled={!canEdit}\n                      />\n                    </Form.Item>\n                    <Button\n                      disabled={!canEdit}\n                      size=\"small\"\n                      onClick={() => remove(name)}\n                      shape=\"circle\"\n                      icon={<MinusOutlined />}\n                    />\n                  </Space>\n                );\n              })}\n\n              <Form.Item>\n                <Button\n                  type=\"dashed\"\n                  onClick={() => add()}\n                  icon={<PlusOutlined />}\n                  disabled={!canEdit}\n                >\n                  Add Output\n                </Button>\n              </Form.Item>\n            </>\n          )}\n        </Form.List>\n        <Form.Item>\n          <Button type=\"primary\" htmlType=\"submit\" block>\n            Transfer\n          </Button>\n        </Form.Item>\n      </Form>\n    </Card>\n  );\n}\n\nfunction App() {\n  useEffect(() => {\n    actions.recoverAccountFromStorage();\n  }, []);\n\n  const [trasfering, setTransfering] = useState(false);\n  const [trasferSensibleFtGenesis, setTrasferSensibleFtGenesis] = useState(\"\");\n  const [account] = useGlobalState(\"account\");\n  const [key] = useGlobalState(\"key\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n  const [initReceivers, setInitReceivers] = useState([]);\n  const [initDatas, setInitDatas] = useState([]);\n  const [initRabins, setRabins] = useState([]);\n\n  const handleTransfer = (genesis) => {\n    setTransfering(true);\n    genesis && setTrasferSensibleFtGenesis(genesis);\n  };\n  const handleCancelTransfer = () => {\n    setTransfering(false);\n    setTrasferSensibleFtGenesis(\"\");\n  };\n\n  const getHashData = () => {\n    if (!window.opener) {\n      return null;\n    }\n    const hash = window.location.hash.substr(1);\n    try {\n      const data = JSON.parse(decodeURIComponent(hash));\n      if (data.type === \"popup\") {\n        if (typeof data.data === \"object\") {\n          return data;\n        }\n      }\n    } catch (err) {}\n    return null;\n  };\n  const handlePopResponseCallback = (resObj) => {\n    const data = getHashData();\n    if (!data) {\n      return;\n    }\n    const postMsg = createPostMsg(window.opener, \"*\");\n    postMsg.emit(data.id, {\n      type: \"response\",\n      data: {\n        ...data.data.data,\n        ...resObj,\n      },\n    });\n  };\n\n  // todo 数值计算 使用 bignumber\n  // todo 此处接收 postMessage 消息，处理登录,transfer\n  const requestAccountCondition = key?.address && account?.network;\n  const transferBsvCondition =\n    requestAccountCondition &&\n    bsvBalance &&\n    util.greaterThanEqual(bsvBalance.balance, 0);\n  useOnceCall(() => {\n    const data = getHashData();\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"requestAccount\") {\n      return;\n    }\n    Modal.confirm({\n      title: \"Connect\",\n      content: (\n        <div>\n          Allow <b>{params.name}</b> to connect your web wallet\n        </div>\n      ),\n      onOk: () => {\n        handlePopResponseCallback({ response: true });\n      },\n      onCancel: () => {\n        handlePopResponseCallback({ error: \"user reject\" });\n      },\n    });\n  }, !!requestAccountCondition);\n  useOnceCall(() => {\n    const data = getHashData();\n    console.log(\"bsv hash data\", data);\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"transferBsv\") {\n      return;\n    }\n    // balance check\n    const outputTotal = params.receivers.reduce(\n      (prev, cur) => util.plus(prev, cur.amount),\n      0\n    );\n    if (util.greaterThan(outputTotal, bsvBalance.balance)) {\n      handlePopResponseCallback({ error: \"insufficient bsv balance\" });\n      return;\n    }\n    setTransfering(true);\n    setInitReceivers(params.receivers);\n  }, !!transferBsvCondition);\n  useOnceCall(() => {\n    const data = getHashData();\n    console.log(\"hashdata\", data);\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"transferSensibleFt\") {\n      return;\n    }\n    // sensibleft balance check\n    const outputTotal = params.receivers.reduce(\n      (prev, cur) => util.plus(prev, cur.amount),\n      0\n    );\n    console.log(\"outputTotal\", outputTotal);\n    const ft = sensibleFtList.find((item) => item.genesis === params.genesis);\n    console.log(\"ft\", ft);\n    if (!ft) {\n      handlePopResponseCallback({ error: \"insufficient ft balance\" });\n      return;\n    }\n    if (util.greaterThan(outputTotal, ft.balance)) {\n      handlePopResponseCallback({ error: \"insufficient ft balance\" });\n      return;\n    }\n    setTransfering(true);\n    setTrasferSensibleFtGenesis(params.genesis);\n    setInitReceivers(params.receivers);\n    setRabins(params.rabinApis);\n  }, !!transferBsvCondition);\n  useOnceCall(() => {\n    const data = getHashData();\n    console.log(\"bsv hash data\", data);\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"transferAll\") {\n      return;\n    }\n    // balance check\n    params.datas.forEach((item) => {\n      // balance check\n      const isBsv = !item.genesis;\n      const ft = sensibleFtList.find((v) => v.genesis === item.genesis);\n\n      const outputTotal = item.receivers.reduce(\n        (prev, cur) => util.plus(prev, cur.amount),\n        0\n      );\n      if (isBsv && util.greaterThan(outputTotal, bsvBalance.balance)) {\n        handlePopResponseCallback({ error: \"insufficient bsv balance\" });\n        return;\n      }\n      if (ft && util.greaterThan(outputTotal, ft.balance)) {\n        handlePopResponseCallback({ error: \"insufficient ft balance\" });\n        return;\n      }\n      setTransfering(true);\n      // console.log(params.datas);\n      setInitDatas(params.datas);\n    });\n  }, !!transferBsvCondition);\n  useEffect(() => {\n    const obu = window.onbeforeunload;\n    window.onbeforeunload = function (event) {\n      handlePopResponseCallback({ error: \"use closed\" });\n      return obu && obu(event);\n    };\n  });\n  return (\n    <div className=\"App\" style={{ overflow: \"hidden\" }}>\n      <Header accountName=\"harry\" />\n      <LoginPanel />\n      {!trasfering && <AccountInfoPanel onTransfer={handleTransfer} />}\n      {trasfering &&\n        (!initDatas || initDatas.length < 1 ? (\n          <TransferPanel\n            genesis={trasferSensibleFtGenesis}\n            rabinApis={initRabins}\n            onCancel={handleCancelTransfer}\n            onTransferCallback={handlePopResponseCallback}\n            initReceivers={initReceivers}\n          />\n        ) : (\n          <TransferAllPanel\n            onCancel={handleCancelTransfer}\n            onTransferCallback={handlePopResponseCallback}\n            initDatas={initDatas}\n          />\n        ))}\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport * as actions from \"./state/action\";\nimport * as Sentry from \"@sentry/react\";\nimport { Integrations } from \"@sentry/tracing\";\n\nconst isIframe = window === window.top;\n\nSentry.init({\n  dsn: \"https://d223c2a1d1bf44b6a657051ac9a99b16@o877284.ingest.sentry.io/5827823\",\n  integrations: [new Integrations.BrowserTracing()],\n\n  // Set tracesSampleRate to 1.0 to capture 100%\n  // of transactions for performance monitoring.\n  // We recommend adjusting this value in production\n  tracesSampleRate: 1.0,\n});\n\nif (isIframe) {\n  ReactDOM.render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n  );\n} else {\n  actions.runIframeTask();\n}\n\n// delete account when page/iframe exit\n(function () {\n  const obu = window.onbeforeunload;\n  window.onbeforeunload = function (event) {\n    const isPopup = !!window.opener;\n    if (!isPopup) {\n      actions.saveAccount(null);\n    }\n    return obu && obu(event);\n  };\n})();\n\n// alert(window === window.top);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}